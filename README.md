#ELWESHAQSMS-BOT
๐ ุจุฑููุช/ููุงุตูุงุช ุชูููุฐูุฉ โ ุจูุช ุงูุฃุฑูุงู (ุงูุฃุฑูุงู ูุถูููุง ุงูุฃุฏููุ ูุงูู API ููุท ูุงุณุชุฎุฑุงุฌ ุฃููุงุฏ ุงูุชุญูู)

> ูุซููุฉ ููุงุตูุงุช ูุงููุฉ ูุงุจูุฉ ููุชูููุฐ ูู ููุจู AI Agent ุฃู ูุทููุฑ.
ุงููุบุฉ: ุงูุนุฑุจูุฉ โ ุงููุงุฌูุฉ ุนูู ุชูููุฌุฑุงู ููุทุ ูุง ูููุน.
ุงููุนูุงุฑูุฉ ุงูููุชุฑุญุฉ: Python (aiogram ุฃู python-telegram-bot) + ูุงุนุฏุฉ ุจูุงูุงุช (PostgreSQL/MySQL/SQLite).
ุฌููุน ุงูุฃุฒุฑุงุฑ Inline Keyboard ูุง ูู ููุฐูุฑ ุบูุฑ ุฐูู.




---

1) ุชุฏููู ุงููุณุชุฎุฏู (User Flow)

1. /start

ุฑุณุงูุฉ ุชุฑุญูุจ.

ูุงุฆูุฉ ุงูุฎุฏูุงุช ุงููุชุงุญุฉ (ุฃุฒุฑุงุฑ ุฅููุงูู):
WhatsApp | Telegram | Facebook | Instagram | Twitter | ...

ุฒุฑ ุฅุถุงูู: ๐ ุชุฌููุน ุฑุตูุฏ ูุฌุงูู (ูุฌูุน ุฑุตูุฏ ููุงุจู ุงูุงุดุชุฑุงู ูู ูููุงุช).



2. ุงุฎุชูุงุฑ ุฎุฏูุฉ โ ุงุฎุชูุงุฑ ุฏููุฉ

ุนุฑุถ ูุงุฆูุฉ ุงูุฏูู (ุงุณู + ุนูู + ููุฏ ุฏููู).

ุฃุฒุฑุงุฑ: ๐ ุชุบููุฑ ุงูุฏููุฉุ ๐ ุฑุฌูุน.



3. ุทูุจ ุฑูู

ุงูุฑูู ูุฃุชู ูู ูุฎุฒูู ุงูุฃุฑูุงู ุงูุฐู ุฃุถุงูู ุงูุฃุฏูู (ูุง ููุฌูุจ ูู API).

ุนูุฏ ุงูุญุฌุฒ: ุชูุณุฌููู ุญุงูุฉ ุงูุฑูู = reserved ูููุณุชุฎุฏู ูุงูุฎุฏูุฉ ูุงูุฏููุฉ.

ููุนุฑุถ:

ุงูุฑูู (ูุงุจู ูููุณุฎ).

ุฃุฒุฑุงุฑ: ๐ ุชุบููุฑ ุงูุฑูู (ูุฌุงููุง), ๐ ุชุบููุฑ ุงูุฏููุฉ, ๐ ุงูุฑุฆูุณูุฉ.




4. ุงูุชุธุงุฑ ุงูููุฏ (Monitor)

ุงูู API ููุณุชุฎุฏู ููุท ููุฑุงูุจุฉ ุงูุฑุณุงุฆู ุงููุงุฑุฏุฉ ูุงุณุชุฎุฑุงุฌ ููุฏ ุงูุชุญูู (OTP).

ุงูุจูุช ูู โูุถุน ุงูุชุญููโ ูุฑุงูุจ ุงูู API ููุทุงุจู ุงูุฑุณุงุฆู ุจุงูุฑูู ุงููุญุฌูุฒ.

ุนูุฏ ุงูุนุซูุฑ ุนูู ุงูููุฏ:

ููุฑุณู ูููุณุชุฎุฏู: ุงูุฑูู + ุงูููุฏ (ูุงุจู ูููุณุฎ).

ููุฎุตู ุงูุณุนุฑ ุงููุญุฏููุฏ ููุฎุฏูุฉ ูู ุฑุตูุฏ ุงููุณุชุฎุฏู.

ุชูุญุฏููุซ ุญุงูุฉ ุงูุฑูู = used ูููุญุฐู ูู ูุงุฆูุฉ ุงููุชุงุญ.


ุฅุฐุง ูู ูุตู ููุฏ ุฎูุงู ูููุฉ (ูุงุจูุฉ ููุชุนููู): ูุง ุฎุตูุ ูุฎูุงุฑุงุช: ุงุณุชุจุฏุงู ุฑูู ุฃู ุฅูุบุงุก.





---

2) ูุธุงู ุงูุฑุตูุฏ (Balance)

ููู ูุณุชุฎุฏู ุญูู ุฑุตูุฏ.

ุงูุฎุตู ูุชู ููุท ุนูุฏ ูุตูู ููุฏ ุตุงูุญ.

ุฅุฐุง ูู ูุตู ููุฏ ุถูู ุงููููุฉ: ูุง ุฎุตู.

ุณุฌู ูุนุงููุงุช (transactions) ูุฃู ุฅุถุงูุฉ/ุฎุตู ูุน ุงูุณุจุจ ูุงูููุช.



---

3) ุชุฌููุน ุฑุตูุฏ ูุฌุงูู ุนุจุฑ ูููุงุช ุงูุงุดุชุฑุงู (Forced/Promo Channels)

3.1 ุชุฏููู ุงููุณุชุฎุฏู

ุฒุฑ ๐ ุชุฌููุน ุฑุตูุฏ ูุฌุงูู.

ูุนุฑุถ ูุงุฆูุฉ ุงููููุงุช (ุฃุฒุฑุงุฑ: ุงูุถูุงู + ุฒุฑ โ ุชุญูู ูู ุงูุงุดุชุฑุงู).

ุนูุฏ ุงูุถุบุท ุนูู โ ุชุญูู:

ูุชุญูู ุงูุจูุช ุนุจุฑ getChatMember ูู ุงุดุชุฑุงู ุงููุณุชุฎุฏู ูู ูู ุงููููุงุช ุงููุทููุจุฉ.

ุนูุฏ ูุฌุงุญ ุงูุชุญูู:

ูุถูู ุฑุตูุฏูุง (ูููุฉ ูุญุฏุฏูุง ุงูุฃุฏูู).

ููุธูุฑ ุฑุณุงูุฉ ูุฌุงุญ ูุน ุงูุฑุตูุฏ ุงููุถุงู ูุจุงูู ุงูุฑุตูุฏ.


ุนูุฏ ุงููุดู:

ููุธูุฑ ุงููููุงุช ุบูุฑ ุงูููุชููุฉ ุงูุงุดุชุฑุงู ูููุง.




3.2 ุฅุฏุงุฑุฉ ูู ุงูุฃุฏูู

ุฅุถุงูุฉ/ุญุฐู ูููุงุช.

ุชุนููู:

ูููุฉ ุงูุฑุตูุฏ ุงููุฌุงูู (ูุซูุงู 5).

ุงูุฏูุฑูุฉ: ูุฑุฉ ูุงุญุฏุฉ ููุท / ูู X ุณุงุนุงุช / ูู X ุฃูุงู (ููุญูุธ ุขุฎุฑ ุชุงุฑูุฎ ููุงูุฃุฉ ูููุณุชุฎุฏู).


ููุงูุญุฉ ุงูุชุญุงูู:

ุญูุธ user_id + channel_id + last_award_at.

ูุง ุชูููุญ ููุงูุฃุฉ ูุชูุฑุฑุฉ ูุจู ุงููุถุงุก ุงููุชุฑุฉ ุงููุญุฏุฏุฉ.

ุฅุนุงุฏุฉ ุงูุชุญูู ูุจู ูู ููุญุฉ.




---

4) ููุญุฉ ุงูุฃุฏูู (ุฏุงุฎู ุงูุจูุช)

4.1 ุฅุฏุงุฑุฉ ุงูุฎุฏูุงุช

โ ุฅุถุงูุฉ ุฎุฏูุฉ (ุงุณู + ุฅูููุฌู + ูุตู ุงุฎุชูุงุฑู + ุณุนุฑ ุงูุชุฑุงุถู).

โ ุญุฐู ุฎุฏูุฉ.

โธ๏ธ ุฅููุงู / โ ุชูุนูู ุฎุฏูุฉ.

๐ ุนุฑุถ ุงูุฎุฏูุงุช (ุงุณูุ ุญุงูุฉุ ุณุนุฑ).

ุดุฑุท ุงูุนุฑุถ ูููุณุชุฎุฏู: ุงูุฎุฏูุฉ ููุนููุฉ ููุฑุจูุทุฉ ุจููููุฑ API ููุชุญูู (ูุถูุงู ุฅููุงููุฉ ุงุณุชูุงู ุงูุฃููุงุฏ).


4.2 ุฅุฏุงุฑุฉ ุงูุฏูู

โ ุฅุถุงูุฉ ุฏููุฉ (ุงุณู + ููุฏ ุฏููู ูุซู +20 + ุนูู).

โ ุญุฐู ุฏููุฉ.

๐ ุนุฑุถ ุงูุฏูู.


4.3 ุฅุฏุงุฑุฉ ุงูุฃุฑูุงู (ูุฎุฒูู ูุฏูู ูู ุงูุฃุฏูู)

๐ ุฑูุน ููู ุฃุฑูุงู (csv/txt).

โ๏ธ ุฅุถุงูุฉ ุฑูู ูุฏูู.

๐ ุนุฑุถ ุงูุฃุฑูุงู ุงููุชุงุญุฉ (ูุน ุชุฑุดูุญ: ุฎุฏูุฉ/ุฏููุฉ/ุญุงูุฉ).

๐๏ธ ุญุฐู ุฑูู.

ููุงุนุฏ:

ุงูุฑูู ูุฑูุฏ ููู ุฎุฏูุฉ/ุฏููุฉ.

ุญุงูุงุช ุงูุฑูู: available | reserved | used | deleted.

ุนูุฏ ุงูุญุฌุฒ ูุชู ุฎุชู reserved_by, reserved_at, ููุฏุฉ ุงููููุฉ.



4.4 ุฅุฏุงุฑุฉ ููููุฑู ุงูู API (ูุฃููุงุฏ ุงูุชุญูู ููุท)

โ ุฅุถุงูุฉ ููููุฑ API (ุงูุงุณูุ base_urlุ ุงูููุชุงุญุ ุทุฑููุฉ ุงูุฌูุจ Poll/Webhookุ ุชุนุจูุฑุงุช/ููุท ุงุณุชุฎุฑุงุฌ ุงูููุฏ RegEx ููู ุฎุฏูุฉ).

๐ ุฑุจุท ุฎุฏูุฉ ุจููููุฑ (ุฎุฏูุฉ โ ูุฒููุฏ).

๐ ุนุฑุถ/ุชุนุทูู/ุญุฐู ูุฒููุฏ.

ุฅุนุฏุงุฏุงุช ุงููุฑุงูุจุฉ:

ูุชุฑุฉ ุงูู Poll (ุซูุงูู).

ูููุฉ ุงูุชุธุงุฑ ุงูููุฏ ุจุนุฏ ุงูุญุฌุฒ (ุฏูุงุฆู).

RegEx ุนูู ูุณุชูู ุงูุฎุฏูุฉ (ูุซุงู ูุงุชุณุงุจ: \b\d{6}\b).



4.5 ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู

โ ุฅุถุงูุฉ ุฑุตูุฏ (ุจุงูุขูุฏู).

โ ุฎุตู ุฑุตูุฏ (ุจุงูุขูุฏู).

๐ ุนุฑุถ ุฑุตูุฏ ูุณุชุฎุฏู.

๐ฅ ุนุฑุถ ุฌููุน ุงููุณุชุฎุฏููู ูุน ุตูุญุงุช (id, username, balance, joined_at, counters).

๐ ุชุนููู/ุฅูุบุงุก ุฃุฏูู ูุณุงุนุฏ.


4.6 ุฑุณุงุฆู ูุฅุดุนุงุฑุงุช

๐ข ุฑุณุงูุฉ ุฌูุงุนูุฉ (ููู ุงููุณุชุฎุฏููู/ูุฑุดูุญ).

โ๏ธ ุฅุฑุณุงู ููุณุชุฎุฏู ูุญุฏุฏ.


4.7 ุฅุนุฏุงุฏุงุช ุนุงูุฉ

๐ ูุถุน ุงูุตูุงูุฉ (ุชุดุบูู/ุฅููุงู) โ ููุธูุฑ ูููุณุชุฎุฏููู ุฑุณุงูุฉ โุงูุจูุช ุชุญุช ุงูุตูุงูุฉโ.

๐ ุงูุฅุญุตุงุฆูุงุช:

ุฅุฌูุงูู ุงููุณุชุฎุฏูููุ ุงูุฃุฑูุงู ุงููุญุฌูุฒุฉุ ุงูุฃููุงุฏ ุงููุณุชููุฉุ ุงูุฃุฑุจุงุญุ ุชูุตูู ุญุณุจ ุฎุฏูุฉ/ุฏููุฉ.


๐ก ูููุงุช ุงูุงุดุชุฑุงู ุงูุฅุฌุจุงุฑู (ุฅุถุงูุฉ/ุญุฐู/ุนุฑุถ).

๐ ุชุบููุฑ ุจุงุณูุฑุฏ ุงูุฃุฏูู.


4.8 ุฅุฏุงุฑุฉ ุงูุจูุชุงุช (ุงุฎุชูุงุฑู ุนูุฏ ุชุดุบูู ุนุฏูุฉ ุจูุชุงุช ุจููุณ ุงูููุงุฉ)

โ ุฅุถุงูุฉ ุจูุช (token + @username + ุจุงุณูุฑุฏ ุฅุฏุงุฑุฉ ูุญูู).

๐ ุนุฑุถ ุงูุจูุชุงุช.

๐๏ธ ุญุฐู ุจูุช.

ูู ุจูุช ูู ูููุฏ/ุฅุนุฏุงุฏุงุช ูููุตูุฉ (ูููุงุช/ุฃุณุนุงุฑ/ููููุฑู API/ูุฎุฒูู ุฃุฑูุงู).



---

5) ูุงุฌูุฉ ุงูุฃุฒุฑุงุฑ (Inline Keyboards)

ุฑุฆูุณูุฉ:

ุงูุฎุฏูุงุช | ๐ ุชุฌููุน ุฑุตูุฏ ูุฌุงูู | ๐ฐ ุฑุตูุฏู | โน๏ธ ูุณุงุนุฏุฉ


ุงุฎุชูุงุฑ ุฎุฏูุฉ โ ูุงุฆูุฉ ุงูุฏูู (ูุงุฆูุฉ ุฅููุงูู ูุน pagination ุฅุฐุง ูุฒู).

ุจุนุฏ ุญุฌุฒ ุฑูู:

๐ ุชุบููุฑ ุงูุฑูู | ๐ ุชุบููุฑ ุงูุฏููุฉ | ๐ ุงูุฑุฆูุณูุฉ


ุชุฌููุน ุฑุตูุฏ ูุฌุงูู:

ููู ููุงุฉ: ุฒุฑ ุงูุถูุงู + ุฒุฑ ุนุงู โ ุชุญูู ูู ุงูุงุดุชุฑุงู.




---

6) ุญุงูุงุช (States) ูุณูุฑ ุงูุนูู (State Machine)

idle โ select_service โ select_country โ reserve_number โ waiting_code โ

ุนูุฏ ููุฏ ุตุญูุญ: code_received โ ุฎุตู ุฑุตูุฏ โ completed.

ุนูุฏ ุงูุชูุงุก ูููุฉ: expired โ ุนุฑุถ ุฎูุงุฑุงุช (ุงุณุชุจุฏุงู/ุฅูุบุงุก).




---

7) ููุงุนุฏ ุงูุชุณุนูุฑ ูุงูุฎุตู

ุงูุณุนุฑ ุงูุงูุชุฑุงุถู ุนูู ูุณุชูู ุงูุฎุฏูุฉ (ูุงุจู ููุชุฎุตูุต ููู ุฏููุฉ ุฅู ูุฒู).

ุงูุฎุตู = ุนูุฏ ูุตูู ุงูููุฏ ููุท.

ุณุฌู ูุนุงููุฉ: (type=purchase, amount, service, number_id, user_id, timestamp).



---

8) ุงุณุชูุฑุงุฏ ุงูุฃุฑูุงู (ููู CSV/TXT)

ุชูุณูู CSV ููุชุฑุญ (ุฑุฃุณ ุงูุฃุนูุฏุฉ):
service,country_code,phone_number,price_override(optional)
ูุซุงู:
WhatsApp,+20,201234567890,

TXT (ุณุทุฑ ููู ุฑูู) ูุน ุงุฎุชูุงุฑ ุงูุฎุฏูุฉ ูุงูุฏููุฉ ูุจู ุงูุงุณุชูุฑุงุฏ.

ูุญุต:

ุฅุฒุงูุฉ ููุฑุฑุงุช.

ุงูุชุญูู ูู ุงูุตูุบุฉ (^\+?\d+$).

ุชุนููู ุงูุญุงูุฉ = available.




---

9) ุชูุงูู ููููุฑ ุงูู API (ููููุฏ ููุท)

9.1 ููุท Poll (ุณุญุจ ุฏูุฑู)

ุฅุนุฏุงุฏ ูุชุฑุฉ ุงูุณุญุจ (ูุซูุงู ูู 5 ุซูุงูู).

endpoint ููุฑุฌุน ุฑุณุงุฆู ุญุฏูุซุฉ (JSON).

ููู ุฑุณุงูุฉ:

ุงุณุชุฎุฑุงุฌ ุงูุฑูู ุงููุณุชูุฏู.

ูุญุงููุฉ ุงุณุชุฎูุงุต ุงูููุฏ ุนุจุฑ RegEx ุญุณุจ ุงูุฎุฏูุฉ.

ุงูุนุซูุฑ ุนูู ุญุฌุฒ ูุทุงุจู (number + service) ูู ุญุงูุฉ waiting_code.

ุนูุฏ ูุฌุงุญ:

ุฑุจุท ุงูุฑุณุงูุฉ ุจุงูุญุฌุฒ.

ุฅุฑุณุงู ุงูููุฏ ูููุณุชุฎุฏู.

ุงูุฎุตู + ุฅุบูุงู ุงูุญุฌุฒ.




9.2 ููุท Webhook (ุงุฎุชูุงุฑู)

ุงุณุชูุจุงู POST ูู ุงููุฒูุฏ.

ููุณ ููุทู ุงููุทุงุจูุฉ ูุงูุงุณุชุฎุฑุงุฌ ูุงูุฎุตู.


9.3 ุฃูุซูุฉ ุญููู ุฑุณุงุฆู ูุฒููุฏ

{
  "messages": [
    {
      "to": "+201234567890",
      "service": "WhatsApp",
      "text": "Your verification code is 123456",
      "ts": "2025-08-28T14:25:00Z",
      "meta": { "provider_id": "X" }
    }
  ]
}

RegEx ุงูุชุฑุงุถู ูุงุชุณุงุจ/ุชููุฌุฑุงู: \b\d{5,6}\b (ูุงุจู ููุชุฎุตูุต).


9.4 ูุทุงุจูุฉ ุงูุฑูู

ุงููุทุงุจูุฉ ุงูุตุงุฑูุฉ ุจุงูุตูุบุฉ ุงูุฏูููุฉ (+CCXXXXXXXXXX).

ุฏุนู ุชูุนูู (ุฅุฒุงูุฉ ูุณุงูุงุช/ุดุฑุทุงุช) ูุจู ุงููุทุงุจูุฉ.


9.5 ูููุฉ ุงูุญุฌุฒ

ุนูุฏ reserve_number ูุญุฏุฏ expires_at (ูุซูุงู 15โ30 ุฏูููุฉ).

ุฅู ุงูุชูุช: ุฅูุบุงุก ุงูุญุฌุฒ ุชููุงุฆููุงุ ูุง ุฎุตู.



---

10) ุงูุฃูู ูุงูุงูุชุซุงู

ุญูุธ ุณุฑ ุงูุฃุฏูู ููุงูุฉ ููุงุชูุญ ุงูู API ูู ูุชุบูุฑุงุช ุจูุฆูุฉ (ENV).

ุณุฌู ุชุฏููู (audit) ููู ุนูููุงุช ุงูุฃุฏูู.

ููุน ุชุณุฑูุจ ุงูุชููู/ุงูููุงุชูุญ ูู ุงูุณุฌูุงุช.

ุงุญุชุฑุงู ุดุฑูุท ุงุณุชุฎุฏุงู ุงูููุตูุงุช ุงูุชู ูุชู ุชููู ุงูุฃููุงุฏ ููุง (ูุณุคูููุฉ ุงููุงูู).

ูุนุฏูู ุทูุจุงุช (rate limit) ูุญูุงูุฉ ูู ุงูุฅุณุงุกุฉ.



---

11) ุงูุฌุฏุงูู (ูููุฐุฌ ูุงุนุฏุฉ ุจูุงูุงุช ููุชุฑุญ)

users

id (pk), telegram_id (unique), username, first_name, last_name,
balance decimal(12,2) default 0, joined_at, is_admin bool, is_banned bool,
last_reward_at (nullable).


services

id, name unique, emoji, description, active bool, default_price decimal(12,2).


service_countries

id, service_id fk, country_name, country_code (e.g. +20), active bool.


numbers

id, service_id fk, country_code, phone_number unique,
status enum(available,reserved,used,deleted),
reserved_by_user_id (nullable), reserved_at (nullable), expires_at (nullable),
code_received_at (nullable), price_override (nullable).


providers (ููููุฑู API ููุฃููุงุฏ)

id, name, base_url, api_key, mode enum(poll,webhook), poll_interval_sec, active bool.


service_provider_map

id, service_id fk, provider_id fk, regex_pattern (ููู ุฎุฏูุฉ).


provider_messages

id, provider_id fk, raw_payload jsonb, received_at.


reservations

id, user_id fk, service_id fk, number_id fk, status enum(waiting_code,completed,expired,canceled),
created_at, completed_at (nullable), expired_at (nullable), code_value (nullable).


transactions

id, user_id fk, type enum(add,deduct,purchase,reward), amount decimal(12,2), reason, created_at.


channels (ูููุงุช ุงูุงุดุชุฑุงู/ุงูููุงูุขุช)

id, title, username_or_link, required bool, active bool, reward_amount decimal(12,2) (ุงุฎุชูุงุฑู).


user_channel_rewards

id, user_id fk, channel_id fk, last_award_at (nullable), times_awarded int.



---

12) ุฃูุงูุฑ ูุฃุฒุฑุงุฑ ุงูุจูุช

ูููุณุชุฎุฏู

/start

๐ฐ ุฑุตูุฏู โ ุฅุธูุงุฑ ุงูุฑุตูุฏ.

๐ ุชุฌููุน ุฑุตูุฏ ูุฌุงูู โ ูุงุฆูุฉ ุงููููุงุช + โ ุชุญูู.

ุงูุฎุฏูุงุช โ ูุงุฆูุฉ ุงูุฎุฏูุงุช.

ุฏุงุฎู ุงูุฎุฏูุฉ: ุงุฎุชูุงุฑ ุงูุฏููุฉ โ ุงุญุฌุฒ ุฑูู.


ููุฃุฏูู

/admin โ ููุญุฉ ุงูุชุญูู (ุชุชุญูู ุจุจุงุณูุฑุฏ ุงูุฃุฏูู ุนูุฏ ุฃูู ุฏุฎูู ููุฌูุณุฉ).

ุฅุฏุงุฑุฉ ุงูุฎุฏูุงุช/ุงูุฏูู/ุงูุฃุฑูุงู/ุงููุฒููุฏูู/ุงููููุงุช/ุงููุณุชุฎุฏููู/ุงูุฑุณุงุฆู/ุงูุฅุญุตุงุฆูุงุช/ุงูุตูุงูุฉ.

ูู ูุณู ุจู Inline Keyboard ูุน ุตูุญุงุช.



---

13) ููุทู โูุถุน ุงูุชุญููโ (Pseudo)

loop every poll_interval_sec:
  msgs = provider.fetch_new_messages()
  for msg in msgs:
      number = normalize(msg.to)
      service = msg.service or infer_from_text(msg.text)
      code = extract(msg.text, regex_for(service))
      if not code: continue
      res = find_active_reservation(number, service, status='waiting_code')
      if not res: continue
      mark numbers[res.number_id].status = 'used'
      res.status = 'completed'
      res.code_value = code
      res.completed_at = now
      price = numbers.price_override or services.default_price
      deduct user.balance by price
      create transaction(user_id=res.user_id, type='purchase', amount=price, reason=f'{service} {number}')
      notify_user(res.user_id, f"ุฑููู: {number}\nุงูููุฏ: {code}")

ุนูุฏ expires_at < now ููู ูุตู ููุฏ:

res.status = 'expired', ุฑูู ูุฑุฌุน available ุฃู ููุณุชุจุฏู ุญุณุจ ุงูุฅุนุฏุงุฏ.




---

14) ุงูุตูุงูุฉ ูุงูุฃุฎุทุงุก

ุฑุณุงูุฉ ููุญูุฏุฉ ุนูุฏ ุงูุตูุงูุฉ.

ุฑุณุงุฆู ุฃุฎุทุงุก ูุงุถุญุฉ:

ููุงุฏ ูุฎุฒูู ุงูุฃุฑูุงู ูุชูู ุงูุฎุฏูุฉ/ุงูุฏููุฉ.

ุนุฏู ููุงูุฉ ุงูุฑุตูุฏ ุนูุฏ ูุญุงููุฉ ุงูุงุณุชุจุฏุงู ุงููุฏููุน (ุฅู ููุฌุฏ).

ูู ูุชู ุงูุนุซูุฑ ุนูู ููููุฑ API ูุฑุชุจุท ุจุงูุฎุฏูุฉ.

ูุดู ุงูุชุญูู ูู ุงูุงุดุชุฑุงูุงุช.




---

15) ุงูุฅุนุฏุงุฏุงุช (ENV)

BOT_TOKEN

ADMIN_PASSWORD

DATABASE_URL

POLL_INTERVAL_SEC (ุงูุชุฑุงุถู 5)

RESERVATION_TIMEOUT_MIN (ูุซูุงู 20)

DEFAULT_REWARD_AMOUNT (ูุซูุงู 5)

ููุงุชูุญ ููููุฑู API (ููู ูุฒููุฏ): PROVIDER_X_API_KEY, PROVIDER_X_URL, ...



---

16) ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช

ุฅุฌูุงูู ุงููุณุชุฎุฏููู.

ุฃุฑูุงู ูุญุฌูุฒุฉ/ูุณุชุฎุฏูุฉ/ููุชููุฉ.

ุฃููุงุฏ ูุณุชููุฉ ุญุณุจ ุฎุฏูุฉ/ุฏููุฉ.

ุฃุฑุจุงุญ ุฅุฌูุงููุฉ ููุชุฑุฉ ุฒูููุฉ.

ุฃูุถู ุงูุฏูู/ุงูุฎุฏูุงุช ุฃุฏุงุกู.

ููุงูุขุช ุงููููุงุช ุงูููุฒุนุฉ.



---

17) ุณูุงุณุงุช ุฅุถุงููุฉ

ูู ุงูุนูููุงุช ุงูููููุฉ ุชูุณุฌููู (audit).

ููุน ุงูุฃุฒุฑุงุฑ ุงููุฏููุฉ (callback_data) ุจุนุฏ ุงูุชูุงุก ุตูุงุญูุชูุง.

ููุน ุชูุฑุงุฑ ุงูููุฑ ุนุจุฑ debounce/answerCallbackQuery.

ุชูุธูู ุงูุฑุณุงุฆู ุงูุญุณูุงุณุฉ (ุญุฐู ุงูููุฏ ุจุนุฏ ุฒูู ุงุฎุชูุงุฑู ูู ุงูุฎุงุต).

ุงุญุชุฑุงู ุณูุงุณุงุช ุชูููุฌุฑุงู ููุฒููุฏู ุงูุฎุฏูุงุช ุงููุณุชูุฏูุฉ.



---

18) ููุงุฐุฌ ุฑุณุงุฆู ูุงุฌูุฉ

ุชุฑุญูุจ:

ุฃููุงู ุจู ๐
ุงุฎุชุฑ ุฎุฏูุฉ ููุญุตูู ุนูู ุฑูู ูุคูุช:

ุงุฎุชูุงุฑ ุฏููุฉ:

ุงุฎุชุฑ ุงูุฏููุฉ ููุฎุฏูุฉ: WhatsApp

ุฑูู ูุญุฌูุฒ:

โ ุชู ุญุฌุฒ ุฑููู:
+20XXXXXXXXXX
ุณูุชู ุฅุฑุณุงู ููุฏ ุงูุชุญูู ููุง ููุฑ ูุตููู.

ูุตูู ููุฏ:

๐ ูุตู ุงูููุฏ!
ุงูุฑูู: +20XXXXXXXXXX
ุงูููุฏ: 123456
ุชู ุฎุตู ุงูุณุนุฑ ูู ุฑุตูุฏู.

ุชุฌููุน ุฑุตูุฏ:

ุงุดุชุฑู ูู ุงููููุงุช ุงูุชุงููุฉ ุซู ุงุถุบุท "โ ุชุญูู" ููุญุตูู ุนูู ุฑุตูุฏ ูุฌุงูู.



---

19) ุชุฑููู ุงูุตูุญุงุช (Pagination)

ุนูุฏ ุนุฑุถ ููุงุฆู ุทูููุฉ (ุงููุณุชุฎุฏููู/ุงูุฃุฑูุงู/ุงูุฎุฏูุงุช/ุงูุฏูู):

ุฃุฒุฑุงุฑ: โฎ๏ธ ุงูุณุงุจู | โญ๏ธ ุงูุชุงูู | ๐ ุฑุฌูุน.

ุญุฌู ุงูุตูุญุฉ ุงูุชุฑุงุถู 10โ20 ุนูุตุฑูุง.




---

20) ุตูุงุญูุงุช ุงูุฃุฏูุงุฑ

owner (ูุงูู): ูู ุงูุตูุงุญูุงุช + ุฅุฏุงุฑุฉ ุงูุฃุฏูู ุงููุณุงุนุฏ.

admin (ูุณุงุนุฏ): ุฅุฏุงุฑุฉ ูุฎุฒูู/ูููุงุช/ูุฒูุฏูู/ูุณุชุฎุฏููู (ุจุญุณุจ ุชูููู ุงููุงูู).

user: ุงุณุชุฎุฏุงู ุงูุฎุฏูุงุช ูุชุฌููุน ุงูุฑุตูุฏ.



---

ุจูุฐุง ุชููู ุงูููุงุตูุงุช ูุงุถุญุฉ:

ุงูุฃุฑูุงู ุชูุฏุงุฑ ูุฏูููุง ูู ุงูุฃุฏูู (ุฑูุน/ุฅุถุงูุฉ/ุญุฐู/ุญุงูุงุช).

ุงูู API ูุฎุตูุต ูุงุณุชุฎุฑุงุฌ ุงูุฃููุงุฏ ููุท ุนุจุฑ ูุฑุงูุจุฉ ุงูุฑุณุงุฆู (Poll/Webhook) ูุฑุจุทูุง ุจุงูุญุฌูุฒุงุช.

ุงูุฎุตู ุนูุฏ ูุตูู ููุฏ ุตุงูุญ ููุท.

ุฑุตูุฏ ูุฌุงูู ุนุจุฑ ุงูุงุดุชุฑุงู ูู ุงููููุงุช ูุน ุชุญููู ูุฏูุฑูุฉ ูููุงูุญุฉ ุชุญุงูู.

ูู ุดูุก ูู ุฏุงุฎู ุงูุจูุช ุนุจุฑ ููุญุฉ ุฃุฏูู ูุฃุฒุฑุงุฑ ุฅููุงูู.


ุจุฑููุช โ ุขููุฉ ุงูุนูู + ุฅุถุงูุฉ ุงูููุงุฑุฏ + ุงูููุทู (ูุงุจู ููุชูููุฐ)


---

ููุฎุต ุณุฑูุน

ุงูุฃุฑูุงู: ููุถูููุง ุงูุฃุฏูู (ูุฏูููุง ุฃู ุฑูุน ููู).

ุงูู API: ููุณุชุฎุฏู ููุท ูุงุณุชุฎุฑุงุฌ ุฃููุงุฏ ุงูุชุญูู (OTP) ุนุจุฑ Poll ุฃู Webhook.

ุงูุฎุตู ูู ุงูุฑุตูุฏ: ุนูุฏ ูุตูู ููุฏ ุตุงูุญ ููุท ุจุนุฏ ูุทุงุจูุฉ ุงูุฑูู ุงููุญุฌูุฒ.

ูู ุงูุนูููุงุช ูุงูุฅุฏุงุฑุฉ ุชุชู ูู ุฏุงุฎู ุงูุจูุช (ููุญุฉ ุฃุฏูู ุฏุงุฎู ุงูุชููุฌุฑุงู).



---

1) ุขููุฉ ุญุฌุฒ ุฑูู ูููุช ุญูุงุชู (Reservation Flow)

1. ุงููุณุชุฎุฏู ูุฎุชุงุฑ ุฎุฏูุฉ โ ูุฎุชุงุฑ ุฏููุฉ โ ูุทูุจ ุฑูู.


2. ุงููุธุงู ูุฎุชุงุฑ number ูู ุฌุฏูู numbers ุญูุซ status = available ูservice_id ูcountry_code ูุทุงุจูุงู.


3. ูููุดุฃ ุณุฌู ูู reservations:

status = waiting_code, reserved_by = user_id, reserved_at = now, expires_at = now + RESERVATION_TIMEOUT.



4. ููุญุฏุซ ุฑูู ุงูุญุงูุฉ ุฅูู reserved.


5. ูุธูุฑ ูููุณุชุฎุฏู ูุงุฌูุฉ ุจูุง: ุงูุฑูู + ุฃุฒุฑุงุฑ (๐ ุชุบููุฑ ุงูุฑูู, ๐ ุชุบููุฑ ุงูุฏููุฉ, ๐ ุงูุฑุฆูุณูุฉ).


6. ุฅุฐุง ุถุบุท ุงููุณุชุฎุฏู ๐ ุชุบููุฑ ุงูุฑูู:

ุฅูุบุงุก ุงูุญุฌุฒ ุงูุญุงูู (reserved โ availableุ ูุณุญ reserved_by).

ุญุฌุฒ ุฑูู ุฌุฏูุฏ ุจููุณ ุงูููุทู ุฏูู ุฎุตู.



7. ุฅุฐุง ุงููุถุช expires_at ููู ูุตู ููุฏ:

reservation.status = expiredุ number.status = available.

ุฅุดุนุงุฑ ูููุณุชุฎุฏู ูุน ุฎูุงุฑุงุช (ุงุญุฌุฒ ุฑูู ุฌุฏูุฏ / ุงุชุตู ุจุงูุฏุนู).





---

2) ููุทู ูุฑุงูุจุฉ ุงูุฃููุงุฏ (Monitor Mode)

Poll Mode (ุฏูุฑู): ูู poll_interval_sec ููุนู:


msgs = provider.fetch_new_messages()
for msg in msgs:
  to = normalize_number(msg.to)
  service = msg.service or infer_service(msg.text)
  code = regex_extract(msg.text, service_regex)
  if not code: continue
  res = find_reservation(number=to, service=service, status='waiting_code')
  if res:
    complete_reservation(res, code)

Webhook Mode: ุนูุฏ ุงุณุชูุจุงู POST ุจููุณ ุงูููุทู ุฃุนูุงู.

ุฏุงูุฉ complete_reservation(res, code):

numbers[res.number_id].status = 'used'

res.status = 'completed', res.code_value = code, res.completed_at = now

ุงูุณุนุฑ = numbers.price_override or services.default_price

ูู user.balance >= price ุฃู ูู ุงูุชุฎุทูุท ุฃู ุงูุฑุตูุฏ ููุฎุตู ุจุนุฏ ูุตูู ุงูููุฏ: deduct_balance(user_id, price)

ุณุฌู transactions ูุน type='purchase'

ุฃุฑุณู ุฑุณุงูุฉ ูููุณุชุฎุฏู: ุฑูู: {number}\nููุฏ: {code}

ุชูุธูู: ุญุฐู ุงูุฑูู ูู ูุงุฆูุฉ ุงููุชุงุญ ููุงุฆููุง ุฃู ูุณูู used.




---

3) ุฅุถุงูุฉ ุงูููุงุฑุฏ (ูู ููุญุฉ ุงูุฃุฏูู ุฏุงุฎู ุงูุจูุช)

3.1 ุฅุถุงูุฉ ุฎุฏูุฉ

ุจูุงูุงุช: name, emoji, description, default_price, active(bool)

ุฅุฌุฑุงุก: /admin โ ุฅุฏุงุฑุฉ ุงูุฎุฏูุงุช โ โ ุฅุถุงูุฉ ุฎุฏูุฉ โ ูุฏุฎู ุงูุญููู.


3.2 ุฅุถุงูุฉ ุฏููุฉ

ุจูุงูุงุช: country_name, country_code (ูุซูุงู +20), flag

ุฅุฌุฑุงุก: ุฅุฏุงุฑุฉ ุงูุฏูู โ โ ุฅุถุงูุฉ ุฏููุฉ.


3.3 ุฅุถุงูุฉ ุฃุฑูุงู (ูุฎุฒูู)

ุทุฑููุชุงู:

ุฑูุน ููู CSV/TXT: ุชูุณูู ููุชุฑุญ service,country_code,phone_number,price_override(optional)

ุฅุถุงูุฉ ูุฏูู: service + country_code + phone_number + price_override


ุนูุฏ ุงูุงุณุชูุฑุงุฏ:

ุชูุธูู: normalize(phone_number), ุฅุฒุงูุฉ ูุณุงูุงุช/ุดุฑุทุงุชุ ุงูุชุฃูุฏ ูู ุงูุตูุบุฉ ^\+?\d+$

ุฅุฒุงูุฉ ุงูููุฑุฑ: ุชุฌุงูู ุฅุฐุง ูุงู ููุฌูุฏูุง.

ุชุนููู status = available.



3.4 ุฅุถุงูุฉ ููููุฑ API (ููููุฏ ููุท)

ุจูุงูุงุช: name, base_url, api_key, mode (poll|webhook), poll_interval_sec, service_regex_map

ุฑุจุท ูุฒููุฏ ุจุฎุฏูุฉ: ุฎุฑูุทุฉ ุชุญุฏุฏ ุฃู regex ูุณุชุฎุฏู ูุงุณุชุฎุฑุงุฌ ุงูููุฏ ููู ุฎุฏูุฉ.


3.5 ุฅุถุงูุฉ ูููุงุช ุชุฌููุน ุฑุตูุฏ

ุจูุงูุงุช: channel_link, reward_amount, frequency (once/daily/weekly/...), active

ุญูุธ ุขุฎุฑ ููุช ููุญุฉ ููู ูุณุชุฎุฏู ููู ููุงุฉ ูููุน ุงูุชูุฑุงุฑ.



---

4) ููุงุนุฏ ููููุฏุงุช ููุทู ุงูููุธููุฉ

ูุทุงุจูุฉ ุงูุฑูู: ุชุทุงุจู ุตุงุฑู ุจุนุฏ normalize ุฅูู ุงูุตูุบุฉ ุงูุฏูููุฉ +CCXXXXXXXX.

ุงุณุชุฎุฑุงุฌ ุงูููุฏ: ููู ุฎุฏูุฉ RegEx ูููุตู (ูุซุงู: \b\d{5,6}\b). ูุงุจู ููุชุนุฏูู ููู ูุฒููุฏ.

ูููุฉ ุงูุญุฌุฒ: RESERVATION_TIMEOUT (ูุซูุงู 15โ30 ุฏูููุฉ). ุงูุชูุงุก ุงููููุฉ ูุนูุฏ ุงูุฑูู ุฅูู available.

ุงูุฎุตู: ููููููุฐ ููุฑ ุฅุชูุงู ุงูุญุฌุฒ ูุงุณุชูุงู ุงูููุฏ (Atomic transaction: ุชุญุฏูุซ ุฑุตูุฏ + ุชุญุฏูุซ ุญุงูุงุช).

ููุน ุงูุชุญุงูู ูู ุงูููุงูุขุช: ุชุญูู getChatMember ุนูุฏ ุทูุจ โ ุชุญููุ ูุณุฌู last_award_at ูููุน ุชูุฑุงุฑ ุงูุฏูุนุฉ ูุจู ุงููุถุงุก frequency.

ุญุงูุงุช ุงูุฎุทุฃ:

ูุง ููุฌุฏ ุฃุฑูุงู ูุชุงุญุฉ โ ุฑุณุงูุฉ "ูุง ููุฌุฏ ุฃุฑูุงู ููุฐู ุงูุฏููุฉ/ุงูุฎุฏูุฉ".

ูุง ููุฌุฏ ููููุฑ API ูุฑุชุจุท โ ุฑุณุงูุฉ "ุงูุฎุฏูุฉ ุบูุฑ ููุนูุฉ ูุนุฏู ุฑุจุท API".

ูุดู ุงูุฎุตู (ุฑุตูุฏ ุบูุฑ ูุงู) โ ุงูุชุฑุงุถู: ุฅุจูุงุบ ุงููุณุชุฎุฏู ูุชุฑู reservation ููุชููุฉ ุฃู ุฅูุบุงุก ุงูุญุฌุฒ.




---

5) ุจูุงูุงุช ูููุฉ ููุฌุฏุงูู (ููุชุทู)

users(telegram_id, username, balance, joined_at, is_admin, last_reward_at)

services(id, name, emoji, default_price, active)

service_countries(service_id, country_name, country_code)

numbers(id, service_id, country_code, phone_number, status, reserved_by, reserved_at, expires_at, price_override)

providers(id, name, base_url, api_key, mode, poll_interval_sec, active)

service_provider_map(service_id, provider_id, regex_pattern)

reservations(id, user_id, service_id, number_id, status, created_at, completed_at, code_value)

transactions(id, user_id, type, amount, reason, created_at)

channels(id, link, reward_amount, frequency, active)

user_channel_reward(id, user_id, channel_id, last_award_at, times_awarded)



---

6) ูุงุฌูุงุช ุงูุฃุฒุฑุงุฑ (ุงูุชุฑุงุญ callback_data)

svc_{service_id} โ ุงุฎุชูุงุฑ ุฎุฏูุฉ

cty_{country_code} โ ุงุฎุชูุงุฑ ุฏููุฉ

resv_change_{reservation_id} โ ุชุบููุฑ ุฑูู

resv_cancel_{reservation_id} โ ุฅูุบุงุก/ุงูุชูุงุก

admin_add_num / admin_import_csv / admin_add_provider / admin_channels_add ุฅูุฎ.



---

7) ุณููุงุฑูููุงุช ููุทูุฉ (ูุซุงูุงู)

ุณููุงุฑูู A โ ูุฌุงุญ ูุงูู

1. ุงููุณุชุฎุฏู ูุญุฌุฒ ุฑูู โ reservation.waiting_code.


2. ุงููุฒููุฏ ูุฑุณู ุฑุณุงูุฉ ููููุฏ ุฅูู +201234....


3. Poll ููุชูุท ุงูุฑุณุงูุฉ โ ูุณุชุฎุฑุฌ 123456 โ ูุฌุฏ ุงูุญุฌุฒ โ ูููู ุงูุญุฌุฒ โ ูุฎุตู 10 ุฌููู โ ูุจููุบ ุงููุณุชุฎุฏู.



ุณููุงุฑูู B โ ุงูุชูุงุก ูููุฉ

1. ุงููุณุชุฎุฏู ูุญุฌุฒ ุฑููุ ูุง ูุตู ููุฏ ุฎูุงู 20 ุฏูููุฉ โ ุงูุญุฌุฒ expired โ ุงูุนุฏุฏ ูุนูุฏ available โ ุงููุณุชุฎุฏู ููุฎุทุฑ ุจุฎูุงุฑ ุงุณุชุจุฏุงู ุฃู ุฅูุบุงุก โ ูุง ุฎุตู.




---

8) ูุชุทูุจุงุช ุงูุชูููุฐ ุงูุชูุตูููุฉ ูุตูุฑุฉ

ุงุญุชูุธ ุจุงูุณุฌูุงุช (audit) ููู ุชุบููุฑ ููุนูู ุงูุฃุฏูู.

ุนูููุงุช ุญุณูุงุณุฉ (ุฎุตู/ุฅููุงู) ุชุชู ุฏุงุฎู ูุนุงููุฉ ูุงุนุฏุฉ ุจูุงูุงุช (transaction).

ุงููุชุบูุฑุงุช ุงููุงุจูุฉ ููุชุนุฏูู ูู ููุญุฉ ุงูุฃุฏูู: RESERVATION_TIMEOUT, POLL_INTERVAL_SEC, DEFAULT_REWARD_AMOUNT, PAGE_SIZE.

ูุงุฌูุฉ /admin ุชุชุทูุจ ุชุญูู ุจุจุงุณูุฑุฏ ุงูุฌูุณุฉ.

ูููุฏ ุฃูุงู: ููุงุชูุญ ูู ENVุ ูุง ุชุทุจุน ุงูู API keys ูู ุงูููุฌุฒ.



---

9) Pseudo ูุญุงูุฉ ุฅุชูุงู ุงูุญุฌุฒ (atomic)

begin transaction
  if reservation.status != 'waiting_code': rollback & return
  if user.balance < price: mark reservation.failed & notify user & rollback
  update numbers.status = 'used'
  update reservation.status = 'completed'; set code_value, completed_at
  insert transaction(user_id, 'purchase', price, reason)
  update users.balance -= price
commit
notify user with number + code


---

ุงููุต ุฃุนูุงู ุฌุงูุฒ ููู ูุญูููู AI Agent ุฅูู ููุงู ุชูููุฐูุฉ (endpointsุ ุฌุฏุงูู DBุ ุฏูุงู Poll/Webhookุ ูุงุฌูุงุช Inline keyboardsุ ูุงุฌูุฉ /admin).

